
<!DOCTYPE html>
<html lang="zh">


<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#202020">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script>
  
  
    <meta name="keywords" content="Javascript,作品,">
  

  
    <meta name="description" content="应用平台WEB">
  
  
  
  <link rel="icon" type="image/x-icon" href="/images/footer-logo.png">
  
  <title>应用平台WEB [ 柚子 ]</title>
  
    <!-- stylesheets list from config.yml -->
    
      <link rel="stylesheet" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css">
    
      <link rel="stylesheet" href="/css/xoxo.css">
    
  
</head>


<body>
  <div class="nav-container">
    <nav class="home-menu pure-menu pure-menu-horizontal">
  <a class="pure-menu-heading" href="/">
    
    <span class="title" style="text-transform:none">柚子</span>
  </a>

  <ul class="pure-menu-list clearfix">
      
          
            
              <li class="pure-menu-item"><a href="/" class="pure-menu-link">首页</a></li>
            
          
      
          
            
              <li class="pure-menu-item pure-menu-has-children pure-menu-allow-hover">
            
              <a href="#" id="post" class="pure-menu-link">文章</a>
              <ul class="pure-menu-children">
              
                  
                    <li class="pure-menu-item"><a href="/archives" style="color:#202020;" class="pure-menu-link">归档</a></li>
                  
              
                  
                    <li class="pure-menu-item"><a href="/tags" style="color:#202020;" class="pure-menu-link">标签</a></li>
                  
              
              </ul>
            </li>
          
      
          
            
              <li class="pure-menu-item"><a href="/projects" class="pure-menu-link">项目</a></li>
            
          
      
          
            
              <li class="pure-menu-item"><a href="/about" class="pure-menu-link">关于</a></li>
            
          
      
          
            
              <li class="pure-menu-item"><a href="/search" class="pure-menu-link">搜索</a></li>
            
          
      
  </ul>
   
</nav>

  </div>

  <div class="container" id="content-outer">
    <div class="inner" id="content-inner">
      <div class="post-container">
  <article class="post" id="post">
    <header class="post-header text-center">
      <h1 class="title">
        应用平台WEB
      </h1>
      <span>
        
        <time class="time" datetime="2016-11-24T19:51:29.000Z">
        2016-11-24
      </time>
        
      </span>
      <span class="slash">/</span>
      <span class="post-meta">
      <span class="post-tags">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/作品/">作品</a></li></ul>
      </span>
    </span>
      <span class="slash">/</span>
      <span class="read">
      <span id="busuanzi_value_page_pv"></span> 点击
    </span>
      <span class="slash">/</span>
      <span class="read">阅读耗时 15 分钟</span>
    </header>

    <div class="post-content">
      <p><img src="/images/homeAndRoom.png" alt="ap"></p>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>项目涉及技术：RequireJS, Vue.js, NodeJS, Express, MongoDB, Bootstrap, WebSocket, JQuery, ES2015。</p>
<a id="more"></a>
<p>应用平台WEB版，是为了做一个网页版的APP store，也就是可以扩展出其他应用的一个平台。目前平台除了搭建了基本的结构之外，还做了一个简单的一对一聊天应用和简单的博客系统。下面将进行简单的介绍，源代码可在demo大师上下载：<a href="http://www.demodashi.com/demo/12539.html" target="_blank" rel="noopener">源码</a>，<a href="https://github.com/renhongl/ailiao" target="_blank" rel="noopener">github点赞</a>。</p>
<h1 id="图文介绍"><a href="#图文介绍" class="headerlink" title="图文介绍"></a>图文介绍</h1><p><img src="/images/signIn.png" alt="ap"></p>
<p>这是登录页面，可以使用用户名和验证了的邮箱登录。</p>
<p><img src="/images/signUp.png" alt="ap"></p>
<p>这是注册页面，很简单的注册一下。 </p>
<p><img src="/images/resetPwd.png" alt="ap"></p>
<p>这是重置密码页面，需要通过验证邮箱的随机码，来实现重置密码。主要是通过后台服务器向邮箱发送信息。</p>
<p><img src="/images/chatHome.png" alt="ap"></p>
<p>这是主模块，包含登录用户的信息显示，并且可以随意设置。可以修改头像，设置状态，还可以添加邮箱，设置是否有消息提示音和提示框。还有就是显示自己的好友分组信息。可以任意修改分组。</p>
<p><img src="/images/homeAndRoom.png" alt="ap"></p>
<p>图的右边就是聊天的窗口，可以同时和多个人聊天，都会列在左边，点击就能切换聊天对象。窗口可以通过关闭所有聊天对象来关闭，或者通过右上角关闭按钮关闭。消息中可以发送一些表情。可以发送抖动窗口的消息。</p>
<p><img src="/images/docs.png" alt="ap"></p>
<p>这个应用是聊天主页的按钮点击出来的，可以显示一些简单的文档，并且可以点击喜欢某个文档，以及添加简单的评论信息。</p>
<h1 id="后端部分代码介绍"><a href="#后端部分代码介绍" class="headerlink" title="后端部分代码介绍"></a>后端部分代码介绍</h1><h2 id="Email-js"><a href="#Email-js" class="headerlink" title="Email.js"></a>Email.js</h2><p>用于发送邮件</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"> 'use strict'</span>;</span><br><span class="line"><span class="keyword">const</span> nodemailer = <span class="built_in">require</span>(<span class="string">'nodemailer'</span>);</span><br><span class="line"><span class="keyword">const</span> Config = <span class="built_in">require</span>(<span class="string">'./Config'</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Email</span> </span>&#123;</span><br><span class="line">	<span class="keyword">constructor</span>(to, subject, text, html) &#123;</span><br><span class="line">		<span class="keyword">this</span>.config = &#123;</span><br><span class="line">			service: <span class="string">'126'</span>,</span><br><span class="line">			auth: &#123;</span><br><span class="line">				user: Config.EMAIL_SERVER,</span><br><span class="line">				pass: Config.EMAIL_PWD            </span><br><span class="line">			&#125;</span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="keyword">this</span>.mailOptions = &#123;</span><br><span class="line">			<span class="keyword">from</span>: Config.EMAIL_SERVER,</span><br><span class="line">			to: to,</span><br><span class="line">			subject: subject,</span><br><span class="line">			text: text,</span><br><span class="line">			<span class="comment">//html: html</span></span><br><span class="line">		&#125;;</span><br><span class="line">		<span class="keyword">this</span>._send();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	_send() &#123;</span><br><span class="line">		<span class="keyword">let</span> transporter = nodemailer.createTransport(<span class="keyword">this</span>.config);</span><br><span class="line">		transporter.sendMail(<span class="keyword">this</span>.mailOptions, <span class="function"><span class="keyword">function</span> (<span class="params">error, info</span>) </span>&#123;</span><br><span class="line">			<span class="keyword">if</span> (error) &#123;</span><br><span class="line">				<span class="keyword">return</span> <span class="built_in">console</span>.log(error);</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">console</span>.log(<span class="string">'Message sent: '</span> + info.response);</span><br><span class="line">			transporter.close();</span><br><span class="line">		&#125;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Email;</span><br></pre></td></tr></table></figure>
<h2 id="Server-js"><a href="#Server-js" class="headerlink" title="Server.js"></a>Server.js</h2><p>作为服务器，并且是Websocket的父类。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"> 'use strict'</span>;</span><br><span class="line"> <span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"> <span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</span><br><span class="line"> <span class="keyword">const</span> socket = <span class="built_in">require</span>(<span class="string">'socket.io'</span>);</span><br><span class="line"> <span class="keyword">const</span> Router = <span class="built_in">require</span>(<span class="string">'./Router'</span>);</span><br><span class="line"> <span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">'body-parser'</span>);</span><br><span class="line"></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Server</span></span>&#123;</span><br><span class="line">     <span class="keyword">constructor</span>(port)&#123;</span><br><span class="line">       <span class="keyword">this</span>.port = port;</span><br><span class="line">       <span class="keyword">this</span>.app = express();</span><br><span class="line">       <span class="keyword">this</span>.server = http.createServer(<span class="keyword">this</span>.app);</span><br><span class="line">       <span class="keyword">this</span>.io = socket.listen(<span class="keyword">this</span>.server);</span><br><span class="line">       <span class="keyword">this</span>._run();</span><br><span class="line">     &#125;</span><br><span class="line">   _run()&#123;</span><br><span class="line">       <span class="keyword">this</span>.server.listen(<span class="keyword">this</span>.port);</span><br><span class="line">       <span class="keyword">this</span>.app.use(bodyParser.json());</span><br><span class="line">       <span class="keyword">this</span>.app.use(bodyParser.urlencoded(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">       <span class="keyword">this</span>.app.use(express.static(__dirname.replace(<span class="regexp">/server\\core/</span>, <span class="string">'app'</span>)));</span><br><span class="line">       <span class="keyword">new</span> Router(<span class="keyword">this</span>.app);</span><br><span class="line">       <span class="built_in">console</span>.log(<span class="string">'HTTP listening: 127.0.0.1:'</span> + <span class="keyword">this</span>.port);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = Server;</span><br></pre></td></tr></table></figure>
<h2 id="User-js"><a href="#User-js" class="headerlink" title="User.js"></a>User.js</h2><p>和用户相关的所有接口都在这里。下面是一个获取验证码的接口，在获取请求后，会随机生成五位数验证码，发送到用户的邮箱中，并且在生成验证码的同时，会调用删除验证码的方法，在一定时间内将此验证码删除，那么用户就不能再使用此验证码修改密码了。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">_getCode()&#123;</span><br><span class="line">  <span class="keyword">this</span>.app.get(<span class="string">'/getCode'</span>, (req, res) =&gt; &#123;</span><br><span class="line">    <span class="keyword">let</span> email = req.query.email;</span><br><span class="line">    <span class="keyword">let</span> code = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++)&#123;</span><br><span class="line">      code += <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> queryData = &#123;</span><br><span class="line">      email: email</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> updateData = &#123;</span><br><span class="line">      code: code</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> callback = <span class="function">(<span class="params">db</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> collection = db.collection(<span class="keyword">this</span>.userCollection);</span><br><span class="line">      collection.updateOne(queryData, &#123;<span class="attr">$set</span>: updateData&#125;, (err, result) =&gt; &#123;</span><br><span class="line">        assert.equal(<span class="literal">null</span>, err);</span><br><span class="line">        db.close();</span><br><span class="line">        <span class="keyword">if</span>(result.result.n === <span class="number">1</span>)&#123;</span><br><span class="line">          <span class="keyword">new</span> Email(email, <span class="string">'重置密码'</span>, <span class="string">'你的验证码是：'</span> + code);</span><br><span class="line">          <span class="keyword">this</span>._removeCode(email);</span><br><span class="line">          res.send(&#123;<span class="attr">status</span>: <span class="string">'success'</span>, <span class="attr">text</span>: <span class="string">'验证码已发往你的邮箱，请查收。30分钟内有效。'</span>&#125;);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">          res.send(&#123;<span class="attr">status</span>: <span class="string">'error'</span>, <span class="attr">text</span>: <span class="string">'没有此邮箱，或许你需要注册账号。'</span>&#125;);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">new</span> MongoDB(<span class="keyword">this</span>.currentDB, callback);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="前端部分代码介绍"><a href="#前端部分代码介绍" class="headerlink" title="前端部分代码介绍"></a>前端部分代码介绍</h1><p>前端模块化采用的是RequireJS，AP_WEB2.0会使用Webpack,那时候会使用ES2015的模块管理。前端的代码较多，这里主要介绍下自己写的特别的功能。QueryString.js用户获取url上的参数信息。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">define([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">QueryString</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>()&#123;</span><br><span class="line">      <span class="keyword">let</span> search = <span class="built_in">window</span>.location.search.substring(<span class="number">1</span>).split(<span class="string">'&amp;'</span>);</span><br><span class="line">      <span class="keyword">let</span> tempGroup = [];</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> p <span class="keyword">of</span> search) &#123;</span><br><span class="line">        tempGroup.push(p.split(<span class="string">'='</span>));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">this</span>.params = <span class="keyword">new</span> <span class="built_in">Map</span>(tempGroup);</span><br><span class="line">    &#125;</span><br><span class="line">    getValue(name)&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="keyword">this</span>.params.get(name);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> queryString = <span class="keyword">new</span> QueryString();</span><br><span class="line">  <span class="keyword">return</span> queryString;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Draggable-js"><a href="#Draggable-js" class="headerlink" title="Draggable.js"></a>Draggable.js</h2><p>用于添加拖动功能，在创建时，传入需要拖动的元素，这个元素就能拖动了。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">define([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Draggable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>($container) &#123;</span><br><span class="line">      <span class="keyword">this</span>.$container = $container;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> subContainer <span class="keyword">of</span> $container.children()) &#123;</span><br><span class="line">        <span class="keyword">this</span>._handleEvents($(subContainer));</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _handleEvents($subContainer) &#123;</span><br><span class="line">      $subContainer.on(<span class="string">'mousedown'</span>, (e) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!$(e.target).hasClass(<span class="string">'button'</span>)) &#123;</span><br><span class="line">          <span class="keyword">this</span>._handleMousedown(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      $(<span class="built_in">document</span>).on(<span class="string">'mousemove'</span>, (e) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!$(e.target).hasClass(<span class="string">'button'</span>)) &#123;</span><br><span class="line">          <span class="keyword">this</span>._handleMousemove(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">      $(<span class="built_in">document</span>).on(<span class="string">'mouseup'</span>, (e) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (!$(e.target).hasClass(<span class="string">'button'</span>)) &#123;</span><br><span class="line">          <span class="keyword">this</span>._handleMouseup(e);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _handleMousedown(e) &#123;</span><br><span class="line">      <span class="keyword">let</span> &#123;left, top&#125; = <span class="keyword">this</span>.$container.css([<span class="string">'left'</span>, <span class="string">'top'</span>]);</span><br><span class="line">      <span class="keyword">this</span>.offsetX = <span class="keyword">this</span>._parseStr(left) - e.clientX;</span><br><span class="line">      <span class="keyword">this</span>.offsetY = <span class="keyword">this</span>._parseStr(top) - e.clientY;</span><br><span class="line">      <span class="keyword">this</span>.mouseDown = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _handleMousemove(e) &#123;</span><br><span class="line">      $(e.target).css(<span class="string">'cursor'</span>, <span class="string">'url(/images/m1.cur),default !important'</span>);</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">this</span>.mouseDown) &#123;</span><br><span class="line">        <span class="keyword">let</span> x = e.clientX;</span><br><span class="line">        <span class="keyword">let</span> y = e.clientY;</span><br><span class="line">        <span class="keyword">let</span> positionX = x + <span class="keyword">this</span>.offsetX;</span><br><span class="line">        <span class="keyword">let</span> positionY = y + <span class="keyword">this</span>.offsetY;</span><br><span class="line">        <span class="keyword">this</span>.$container.css(&#123;</span><br><span class="line">          left: positionX,</span><br><span class="line">          top: positionY,</span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _handleMouseup(e) &#123;</span><br><span class="line">      $(e.target).css(<span class="string">'cursor'</span>, <span class="string">'url(/images/m1.cur),default !important'</span>);</span><br><span class="line">      <span class="keyword">this</span>.mouseDown = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _parseStr(str) &#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> str !== <span class="string">'string'</span>)&#123;</span><br><span class="line">        str += <span class="string">''</span>; </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Number</span>(str.split(<span class="string">'px'</span>)[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> Draggable;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Rain-js"><a href="#Rain-js" class="headerlink" title="Rain.js"></a>Rain.js</h2><p>用于添加鼠标点击效果，创建之后，在整个网页中，除了class中有button的元素，其他都会在点击时，出现像雨滴落在地上的效果。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line">define([], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="meta">  'use strict'</span>;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">Rain</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">      <span class="keyword">this</span>.settings = &#123;</span><br><span class="line">        width: <span class="number">10</span>,</span><br><span class="line">        height: <span class="number">10</span>,</span><br><span class="line">        borderColor: <span class="string">'#c6cac9'</span>,</span><br><span class="line">        opacity: <span class="number">0.7</span>,</span><br><span class="line">        borderRadius: <span class="number">5</span>,</span><br><span class="line">        borderWidth: <span class="number">5</span>,</span><br><span class="line">        maxWidth: <span class="number">70</span>,</span><br><span class="line">        widthOffset: <span class="number">2</span>,</span><br><span class="line">        radiusOffset: <span class="number">1</span>,</span><br><span class="line">        opacityOffset: <span class="number">0.05</span>,</span><br><span class="line">        borderOffset: <span class="number">1</span>,</span><br><span class="line">        position: <span class="string">'fixed'</span>,</span><br><span class="line">        zIndex: <span class="number">100</span>,</span><br><span class="line">        borderStyle: <span class="string">'solid'</span>,</span><br><span class="line">        class: 'rain',</span><br><span class="line">      &#125;;</span><br><span class="line">      <span class="keyword">this</span>._handleEvents();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _handleEvents() &#123;</span><br><span class="line">      <span class="keyword">let</span> settings = <span class="keyword">this</span>.settings;</span><br><span class="line">      $(<span class="built_in">document</span>).on(<span class="string">'click'</span>, (e) =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span>($(e.target).hasClass(<span class="string">'button'</span>))&#123;</span><br><span class="line">          <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> $rain = $(<span class="string">'&lt;div&gt;'</span>).attr(<span class="string">'class'</span>, settings.class).css(&#123;</span><br><span class="line">          position: settings.position,</span><br><span class="line">          zIndex: settings.zIndex,</span><br><span class="line">          borderStyle: settings.borderStyle,</span><br><span class="line">        &#125;);</span><br><span class="line">        $(<span class="string">'body'</span>).append($rain);</span><br><span class="line">        <span class="keyword">let</span> x = e.clientX;</span><br><span class="line">        <span class="keyword">let</span> y = e.clientY;</span><br><span class="line">        <span class="keyword">this</span>._initRain($rain, x, y);</span><br><span class="line">        <span class="keyword">this</span>._updateRain($rain, x, y);</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _updateRain($rain, x, y) &#123;</span><br><span class="line">      <span class="keyword">let</span> settings = <span class="keyword">this</span>.settings;</span><br><span class="line">      <span class="keyword">let</span> rainThread = setInterval( <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> &#123;width, height,top, left, opacity, borderWidth, borderRadius&#125; = $rain.css([<span class="string">'width'</span>, <span class="string">'height'</span>,<span class="string">'top'</span>, <span class="string">'left'</span>, <span class="string">'opacity'</span>, <span class="string">'borderWidth'</span>, <span class="string">'borderRadius'</span>]);</span><br><span class="line">        $rain.css(&#123;</span><br><span class="line">          width: <span class="keyword">this</span>._parseStr(width) + settings.widthOffset,</span><br><span class="line">          height: <span class="keyword">this</span>._parseStr(height) + settings.widthOffset,</span><br><span class="line">          top: y - <span class="keyword">this</span>._parseStr(height) / <span class="number">2</span>,</span><br><span class="line">          left: x - <span class="keyword">this</span>._parseStr(width) / <span class="number">2</span>,</span><br><span class="line">          opacity: <span class="keyword">this</span>._parseStr(opacity) - settings.opacityOffset,</span><br><span class="line">          borderWidth: <span class="keyword">this</span>._parseStr(borderWidth) + settings.borderOffset,</span><br><span class="line">          borderRadius: <span class="keyword">this</span>._parseStr(borderRadius) + settings.radiusOffset,</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>._parseStr(width) &gt; settings.maxWidth) &#123;</span><br><span class="line">          clearInterval(rainThread);</span><br><span class="line">          $rain.remove();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">10</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _initRain($rain, x, y) &#123;</span><br><span class="line">      <span class="keyword">let</span> settings = <span class="keyword">this</span>.settings;</span><br><span class="line">      $rain.css(&#123;</span><br><span class="line">        width: settings.width,</span><br><span class="line">        height: settings.height,</span><br><span class="line">        borderColor: settings.borderColor,</span><br><span class="line">        opacity: settings.opacity,</span><br><span class="line">        borderRadius: settings.borderRadius,</span><br><span class="line">        borderWidth: settings.borderWidth,</span><br><span class="line">        top: y - <span class="keyword">this</span>._parseStr(settings.height) / <span class="number">2</span>,</span><br><span class="line">        left: x - <span class="keyword">this</span>._parseStr(settings.width) / <span class="number">2</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _parseStr(str)&#123;</span><br><span class="line">      <span class="keyword">if</span>(<span class="keyword">typeof</span> str !== <span class="string">'string'</span>)&#123;</span><br><span class="line">        str += <span class="string">''</span>; </span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">Number</span>(str.split(<span class="string">'px'</span>)[<span class="number">0</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> Rain;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="Message-js"><a href="#Message-js" class="headerlink" title="Message.js"></a>Message.js</h2><p>最后一个要介绍的是Message.js，它是一个全局提示的工具，项目中使用它做ajax返回信息的控制，做聊天室消息预览等。当有一些信息要发送给用户时，会在浏览器的右上角出现对话框，包含信息标题，信息内容等。并且分为几种类型的提示，不同类型会有不同主题的对话框出现。由于代码太多，这里只列出了它的构造方法。</p>
  <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(type, content) &#123;</span><br><span class="line">  <span class="keyword">this</span>.title = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">this</span>.content = content;</span><br><span class="line">  <span class="keyword">this</span>.showTime = <span class="number">5000</span>;</span><br><span class="line">  <span class="keyword">this</span>.clearTime = <span class="number">1000</span>;</span><br><span class="line">  <span class="keyword">this</span>.clearThread = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.timeThread = <span class="literal">null</span>;</span><br><span class="line">  <span class="keyword">this</span>.$Message = $(<span class="string">'&lt;div&gt;'</span>).css(&#123;</span><br><span class="line">    color: <span class="string">'#fff'</span>,</span><br><span class="line">    borderRadius: <span class="number">5</span>,</span><br><span class="line">    width: <span class="number">300</span>,</span><br><span class="line">    display: <span class="string">'none'</span>,</span><br><span class="line">    zIndex: <span class="number">110</span>,</span><br><span class="line">    margin: <span class="string">'2px 5px'</span>,</span><br><span class="line">    clear: <span class="string">'both'</span>,</span><br><span class="line">    float: <span class="string">'right'</span>,</span><br><span class="line">    position: <span class="string">'relative'</span>,</span><br><span class="line">    boxShadow: <span class="string">'0px 0px 10px rgba(255, 255, 255, 1)'</span>,</span><br><span class="line">    opacity: <span class="number">0.9</span>,</span><br><span class="line">  &#125;).addClass(<span class="string">'message'</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.$icon = $(<span class="string">'&lt;i&gt;'</span>).css(&#123;</span><br><span class="line">    display: <span class="string">'inline-block'</span>,</span><br><span class="line">    float: <span class="string">'left'</span>,</span><br><span class="line">    marginLeft: <span class="number">10</span>,</span><br><span class="line">    width: <span class="number">20</span>,</span><br><span class="line">    textAlign: <span class="string">'center'</span>,</span><br><span class="line">    fontSize: <span class="string">'1.2em'</span>,</span><br><span class="line">  &#125;).addClass(<span class="string">'msgIcon'</span>).appendTo(<span class="keyword">this</span>.$Message);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.$title = $(<span class="string">'&lt;div&gt;'</span>).css(&#123;</span><br><span class="line">    height: <span class="string">'45%'</span>,</span><br><span class="line">    width: <span class="number">260</span>,</span><br><span class="line">    float: <span class="string">'right'</span>,</span><br><span class="line">    fontSize: <span class="string">'1.2em'</span>,</span><br><span class="line">  &#125;).addClass(<span class="string">'msgTitle'</span>).appendTo(<span class="keyword">this</span>.$Message);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.$time = $(<span class="string">'&lt;span&gt;'</span>).css(&#123;</span><br><span class="line">    position: <span class="string">'absolute'</span>,</span><br><span class="line">    top: <span class="number">2</span>,</span><br><span class="line">    right: <span class="number">2</span>,</span><br><span class="line">    fontSize: <span class="string">'0.7em'</span>,</span><br><span class="line">  &#125;).addClass(<span class="string">'msgTime'</span>).appendTo(<span class="keyword">this</span>.$Message);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.$content = $(<span class="string">'&lt;div&gt;'</span>).css(&#123;</span><br><span class="line">    float: <span class="string">'right'</span>,</span><br><span class="line">    height: <span class="string">'56%'</span>,</span><br><span class="line">    width: <span class="number">260</span>,</span><br><span class="line">    paddingBottom: <span class="number">5</span>,</span><br><span class="line">    paddingRight: <span class="number">5</span>,</span><br><span class="line">    fontSize: <span class="string">'0.8em'</span>,</span><br><span class="line">  &#125;).addClass(<span class="string">'msgContent'</span>).appendTo(<span class="keyword">this</span>.$Message);</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'infor'</span>:</span><br><span class="line">      <span class="keyword">this</span>.title = <span class="string">'提示'</span>;</span><br><span class="line">      <span class="keyword">this</span>._infor();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'success'</span>:</span><br><span class="line">      <span class="keyword">this</span>.title = <span class="string">'成功'</span>;</span><br><span class="line">      <span class="keyword">this</span>._success();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'error'</span>:</span><br><span class="line">      <span class="keyword">this</span>.title = <span class="string">'错误'</span>;</span><br><span class="line">      <span class="keyword">this</span>._error();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'warning'</span>:</span><br><span class="line">      <span class="keyword">this</span>.title = <span class="string">'警告'</span>;</span><br><span class="line">      <span class="keyword">this</span>._warning();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">'message'</span>:</span><br><span class="line">      <span class="keyword">this</span>._message();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>写代码很重要，调试也很重要，好的调试方法，可以更快的发现、解决问题。正视错误，用积极的态度去处理错误，会提升自己面临问题时的处理能力。</p>

    </div>

  </article>
  <div class="toc-container">
    
  <div id="toc" class="toc-article">
    <strong class="toc-title">目录</strong>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#简介"><span class="toc-text">简介</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#图文介绍"><span class="toc-text">图文介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#后端部分代码介绍"><span class="toc-text">后端部分代码介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Email-js"><span class="toc-text">Email.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Server-js"><span class="toc-text">Server.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#User-js"><span class="toc-text">User.js</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#前端部分代码介绍"><span class="toc-text">前端部分代码介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Draggable-js"><span class="toc-text">Draggable.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Rain-js"><span class="toc-text">Rain.js</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Message-js"><span class="toc-text">Message.js</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#总结"><span class="toc-text">总结</span></a></li></ol>
  </div>


  </div>
</div>
<div class="copyright">
    <span>本作品采用</span>
    <a href="https://creativecommons.org/licenses/by/4.0/">知识共享署名 4.0 国际许可协议</a>
    <span>进行许可。 转载时请注明原文链接。</span>
</div>


  
    <div class="post-nav">
      <div class="post-nav-item post-nav-next">
        
          <span>〈 </span>
          <a href="/2016/11/15/应用平台桌面版/" rel="next" title="应用平台桌面版">
          应用平台桌面版
          </a>
        
      </div>
  
      <div class="post-nav-item post-nav-prev">
          
          <a href="/2016/12/04/电脑远程控制工具/" rel="prev" title="电脑远程控制工具">
            电脑远程控制工具
          </a>
          <span>〉</span>
        
      </div>
    </div>
  

  <section class="disqus-comments">
    <div id="disqus_thread">
      <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
  </section>

  <script>
    var disqus_shortname = 'renhongl';
    
    var disqus_url = 'https://renhongl.github.io/2016/11/24/应用平台WEB/';
    
    (function(){
      var dsq = document.createElement('script');
      dsq.type = 'text/javascript';
      dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>

  <script id="dsq-count-scr" src="//renhongl.disqus.com/count.js" async></script>



    </div>

    

  </div>
  <footer class="footer text-center">
    <div id="bottom-inner">
        <a class="bottom-item" href="https://github.com/renhongl" target="_blank">GitHub</a> |
        <a class="bottom-item" href="/links">友情链接</a> |
        <a class="bottom-item" href="https://hexo.io" target="_blank">Powered by hexo</a> |
        <a class="bottom-item" href="https://github.com/fooying/hexo-theme-xoxo-plus" target="_blank">Theme xoxo-plus</a> |
        <a class="bottom-item" href="/atom.xml">订阅</a>
    </div>
</footer>

  

<script>
  (function(window, document, undefined) {

    var timer = null;

    function returnTop() {
      cancelAnimationFrame(timer);
      timer = requestAnimationFrame(function fn() {
        var oTop = document.body.scrollTop || document.documentElement.scrollTop;
        if (oTop > 0) {
          document.body.scrollTop = document.documentElement.scrollTop = oTop - 50;
          timer = requestAnimationFrame(fn);
        } else {
          cancelAnimationFrame(timer);
        }
      });
    }

    var hearts = [];
    window.requestAnimationFrame = (function() {
      return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          setTimeout(callback, 1000 / 60);
        }
    })();
    init();

    function init() {
      css(".heart{z-index:9999;width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: absolute;}.heart:after{top: -5px;}.heart:before{left: -5px;}");
      attachEvent();
      gameloop();
      addMenuEvent();
    }

    function gameloop() {
      for (var i = 0; i < hearts.length; i++) {
        if (hearts[i].alpha <= 0) {
          document.body.removeChild(hearts[i].el);
          hearts.splice(i, 1);
          continue;
        }
        hearts[i].y--;
        hearts[i].scale += 0.004;
        hearts[i].alpha -= 0.013;
        hearts[i].el.style.cssText = "left:" + hearts[i].x + "px;top:" + hearts[i].y + "px;opacity:" + hearts[i].alpha + ";transform:scale(" + hearts[i].scale + "," + hearts[i].scale + ") rotate(45deg);background:" + hearts[i].color;
      }
      requestAnimationFrame(gameloop);
    }

    /**
     * 给logo设置点击事件
     * 
     * - 回到顶部
     * - 出现爱心
     */
    function attachEvent() {
      var old = typeof window.onclick === "function" && window.onclick;
      var logo = document.getElementById("logo");
      if (logo) {
        logo.onclick = function(event) {
          returnTop();
          old && old();
          createHeart(event);
        }
      }
      
    }

    function createHeart(event) {
      var d = document.createElement("div");
      d.className = "heart";
      hearts.push({
        el: d,
        x: event.clientX - 5,
        y: event.clientY - 5,
        scale: 1,
        alpha: 1,
        color: randomColor()
      });
      document.body.appendChild(d);
    }

    function css(css) {
      var style = document.createElement("style");
      style.type = "text/css";
      try {
        style.appendChild(document.createTextNode(css));
      } catch (ex) {
        style.styleSheet.cssText = css;
      }
      document.getElementsByTagName('head')[0].appendChild(style);
    }

    function randomColor() {
      // return "rgb(" + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + "," + (~~(Math.random() * 255)) + ")";
      return "#F44336";
    }

    function addMenuEvent() {
      var menu = document.getElementById('menu-main-post');
      if (menu) {
        var toc = document.getElementById('toc');
        if (toc) {
          menu.onclick = function() {
            if (toc) {
              if (toc.style.display == 'block') {
                toc.style.display = 'none';
              } else {
                toc.style.display = 'block';
              }
            }
          };
        } else {
          menu.style.display = 'none';
        }
      }
    }

  })(window, document);
</script>

  



  
<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
</script>


</body>
</html>
